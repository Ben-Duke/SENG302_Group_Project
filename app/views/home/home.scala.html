@import play.filters.csrf.AddCSRFToken
@(user: User)
@import views.html.bootstrap3._
@main("Index"){


    <head>
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/home.css")">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.css">
        <title>Home</title>
    </head>

    <div class="container">
        <h1>@user.fName @user.lName @if(user.userIsAdmin) {<img class="img"  width = "60" height="50" src="../assets/images/key_2_small.png"> } </h1>
    </div>

    <br>

    <div class="container">
        <div class="row">
                <!-- The profile picture, currently a placeholder -->
            <div class="text-center">
                <a href="#" data-toggle="modal" data-target="#addProfilePhoto">
                    <img class="img-circle" width = "150" src="@{routes.HomeController.serveProfilePicture()}" alt="@routes.Assets.at("images/Generic.png")">
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <h2>Profile</h2>
                <p>Email: @user.getEmail()</p>
                <p>Gender: @user.gender</p>
                <p>Date of Birth: @user.dateOfBirth</p>
                <p>Passport(s):
                    <div class="col-sm-offset-4">
                        <ul class="list-group" >
                            @for(passport <- user.passports) {
                            <li class="list-group-item">@passport.passportName</li>
                            }
                        </ul>
                    </div>
                </p>
                <p>Nationalit(y/ies):
                    <ul class="list-group col-sm-offset-4" >
                        @for(nationality <- user.nationality) {
                        <li class="list-group-item">@nationality.nationalityName</li>
                        }
                    </ul>
                </p>
                <p>Traveller type(s):
                    <div class="col-sm-offset-4">
                        <ul class="list-group" >
                            @for(travellerType <- user.travellerTypes) {
                                <li class="list-group-item">@travellerType.travellerTypeName</li>
                            }
                        </ul>
                    </div>
                </p>
                <p>Creation date: @user.creationDate</p>
                <form>
                    <button class="btn btn-default" formaction="@routes.ProfileController.updateProfile()">Update profile</button>
                    <button class="btn btn-default" formaction="@routes.TravellerTypeController.updateTravellerType()">Update traveller type</button>
                    @if(user.userIsAdmin) {
                    <button class="btn btn-default" formaction="@routes.AdminController.indexAdmin()">Admin</button>
                    }
                </form>
            </div>
            <div class="col-md-4">
                <h2>Trips</h2>
                <form>
                    <div class="list-group">
                    @for(trip <- user.getTripsSorted) {
                        <a href="@routes.TripController.displaytrip(trip.tripid,"")" class="list-group-item list-group-item-action">
                        @trip.tripName
                        </a>
                    }
                    </div>
                    <button class="btn btn-default" formaction="@routes.DestinationController.indexDestination()">Destinations</button>
                    <button class="btn btn-default" formaction="@routes.TripController.createtrip()">Create trip</button>
                </form>
            </div>
            <div class="col-md-4">
                <h2>Insights</h2>
                <form>
                    <button class="btn btn-default" formaction="@routes.TravelPartnerController.renderFilterPage()">Search profile</button>
                </form>
            </div>
        </div>


        <br>



            <!-- Trigger the modal with a button -->
        <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#addPhotoModal">Add Photo</button>


            <!-- Modal -->
        <div id="addPhotoModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                    <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Upload a new photo </h4>
                    </div>

                    <div class="modal-body">
                    @helper.form(action = routes.HomeController.upload, 'id -> "myForm", 'enctype -> "multipart/form-data") {
                        @helper.CSRF.formField
                        <input type="file" name="picture" required>

                        <br>

                        <p>
                            <input type="submit" value="Upload">
                            @helper.CSRF.formField
                            <input type="checkbox" name="private" value="private"> Make photo private
                        </p>

                    }


                    </div>
                </div>
            </div>


        </div>

        <!-- Modal to upload a new profile picture -->
        <div id="addProfilePhoto" class="modal fade" role="dialog">
            <div class="modal-dialog">

                    <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Upload a new profile picture </h4>
                    </div>

                    <div class="modal-body">
                    @helper.form(action = routes.HomeController.uploadProfilePicture, 'id -> "myForm", 'enctype -> "multipart/form-data") {
                        @helper.CSRF.formField
                        <!--<input type="file" accept="image/*" name="picture" required onchange="readURL(this);"/> -->
                        <div class="profile-pic-wraper col-sm-8">
                            <img id="change-profile-pic" src="@{routes.HomeController.serveProfilePicture()}" alt="@routes.Assets.at("images/Generic.png")"/>
                        </div>
                        <div class="preview-wrapper">
                            <div class="preview">

                            </div><br>
                        </div>
                        <br>
                        <input type="file" accept="image/*" name="picture" required onchange="loadFile(event);"/>
                        <p>
                            <input type="submit" value="Upload">
                            @helper.CSRF.formField
                            <input type="checkbox" name="private" value="private"> Make photo private
                        </p>

                    }


                    </div>
                </div>
            </div>


        </div>


        <br>


        <div>
            <div id="modal-picture" class="modal">
                <img class="modal-content" id="img01">
            </div>
            @for(photo <- user.getUserPhotos) {
                <img class="img-thumbnail" id=@{photo.getUrl} width="60" src="@{routes.HomeController.index(photo.getUrlWithPath)}" alt="User Image">
            }
            <script>
                    // Get the modal
                    var modal = document.getElementById('modal-picture');
                    // When the user clicks, they quit the modal view
                    modal.onclick = function () {
                        this.style.display = "none";
                    };

                    // Get the image and insert it inside the modal
                    var images = document.getElementsByClassName("img-thumbnail");
                    var modalImg = document.getElementById("img01");
                    // loops through each thumbnail and adds the event listener
                    for (i = 0; i < @user.getUserPhotos.length; i++) {
                        images[i].onclick = function() {
                            modal.style.display = "block";
                            modalImg.src = this.src;
                        };
                    }
            </script>
        </div>
    </div>
    <p>
            <!-- Below are a series of inputs which allow file selection and interaction with the cropper api -->
        <input type="file" id="fileInput" accept="image/*" />
        <input type="button" id="btnCrop" value="Crop" />
        <input type="button" id="btnRestore" value="Restore" />
    </p>
    <div>
        <canvas id="canvas">
            Your browser does not support the HTML5 canvas element.
        </canvas>
    </div>

    <div id="result"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropper/4.0.0/cropper.min.js"></script>
    <script src="@routes.Assets.at("js/home.js")" type="text/javascript"></script>
}
