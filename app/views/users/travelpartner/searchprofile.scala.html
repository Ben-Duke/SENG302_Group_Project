@import helper._
@import views.html.bootstrap3._

@import play.data.DynamicForm

@(dynamicForm : DynamicForm, travellerTypes : java.util.List[String], nationalities : java.util.List[String], genderMap: java.util.Map[String, java.lang.Boolean], resultProfiles : java.util.Set[User], user : User)


@main(user, "Search") {
    <div class="container-fluid">
        <h1>Search</h1>

        @form(action = helper.CSRF(routes.TravelPartnerController.searchByAttribute)) {

            @checkboxes(
                dynamicForm("gender"),
                label = "Gender selection",
                checkboxMap = genderMap,
                help = "Select the genders you would like to include in your search results"
            )

            @helper.select(
                field = dynamicForm("travellertype"),
                options = travellerTypes.map(travellerType => travellerType -> travellerType),
                '_label -> "Select a traveller type to add:"
            )

            @helper.select(
                dynamicForm("nationality"),
                options = nationalities.map(nationality => nationality -> nationality),
                '_label -> "Select a nationality to add:"
            )

            @helper.inputDate(dynamicForm("agerange1"), '_label -> "Born after:")
            @helper.inputDate(dynamicForm("agerange2"), '_label -> "Born before:")

            <input type="submit" value="Search by filters">

    </div>


        @if(resultProfiles.nonEmpty) {

            <table class="table" id="searchResultsTable">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col" onClick="sortTable(0)" style="cursor: pointer;">Name</th>
                        <th scope="col" onClick="sortTable(1)" style="cursor: pointer;">Gender</th>
                        <th scope="col" onClick="sortTable(2)" style="cursor: pointer;">Nationalities</th>
                        <th scope="col" onClick="sortTable(3)" style="cursor: pointer;">DOB</th>
                        <th scope="col" onClick="sortTable(4)" style="cursor: pointer;">Traveller types</th>
                        <th scope="col" style="cursor: pointer;"></th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                @if(! resultProfiles.isEmpty) {
                    @for(profile <- resultProfiles) {
                        <tr>
                            <td scope="row">@profile.getFName().substring(0, 1).toUpperCase()@profile.getFName().substring(1).toLowerCase() @profile.getLName().substring(0, 1).toUpperCase()@profile.getLName().substring(1).toLowerCase()</td>
                            <td>@profile.getGender()</td>
                            <td>@for(nationality <- profile.getNationality()) {
                                <p>@nationality.getNationalityName()</p>
                            }</td>
                            <td>@profile.getDateOfBirth()</td>
                            <td>@for(travellerType <- profile.getTravellerTypes()) {
                                <p>@travellerType.getTravellerTypeName()</p>
                            }</td>
                            <td><a class="btn btn-link" href="@routes.ProfileController.showProfile(profile.getUserid)">View</a></td>
                            <td class="followLink" data-profile="@profile.getUserid">
                                <a class="btn btn-link" id="follow-@profile.getUserid" onclick="followUser(@profile.getUserid)" style="display: none;">
                                    Follow
                                </a>
                                <a class="btn btn-link d-none" id="unfollow-@profile.getUserid" onclick="unfollowUser(@profile.getUserid)" style="display: none;">
                                    Unfollow
                                </a>
                            </td>
                        </tr>
                        }
                        </tbody>
                    </table>
                } else {
                </tbody>
            </table>
            <h2 align="center">No results found</h2>
            }

        } else {
            <h2 align="center">No results displayed</h2>
        }

    }
}

<script src="@routes.Assets.at("js/search/searchUsers.js")"></script>