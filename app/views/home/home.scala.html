@import play.filters.csrf.AddCSRFToken
@import factories.UserFactory
@import views.html.users.profile.countryErrorMessage
@import views.html.bootstrap3._

@(user: User, adminUser: User)

@main(user, "Index"){


    <head>
        <link rel="stylesheet" href="@routes.Assets.at("stylesheets/cropper.min.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/home.css")">
        <title>Home</title>
    </head>
    <div class="container">
            <!-- The thumbnail in the else is being displayed to show the AC passing -->
        <h1>@user.fName @user.lName
            @if(UserFactory.getUserProfilePicture(user.getUserid()) != null){
                <img class="img-circle"  width = "50" height="50" src="@{routes.HomeController.serveProfilePicture(user.getUserid())}">
            } else {
                <img class="img-circle"  width = "50" height="50" src="@{routes.Assets.at("images/Generic.png")}">
            }
            @if(user.userIsAdmin) {
                <img class="img"  width = "60" height="50" src="../assets/images/key_2_small.png">
            }
            @if(adminUser != null) {
                <button class="btn btn-default" formaction="@routes.DestinationController.indexDestination()">
                    Back to your profile
                </button>
            }
        </h1>
    </div>

    <br>

    <div class="container">
        <div class="row">
                <!-- The profile picture, currently a placeholder -->
            <div class="text-center">
                <a href="#" data-toggle="modal" data-target="#addProfilePhoto">
                    @if(UserFactory.getUserProfilePicture(user.getUserid()) != null){
                        <img class="img-circle" width = "150" height = "150" src="@{routes.HomeController.serveProfilePicture(user.getUserid())}")>
                    } else {
                        <img class="img-circle" width = "150" height = "150" src="@{routes.Assets.at("images/Generic.png")}")>
                        }
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <h2>Profile</h2>
                <p>Email: @user.getEmail()</p>
                <p>Gender: @user.gender</p>
                <p>Date of Birth: @user.dateOfBirth</p>
                <p>Passport(s):
                    <div class="col-sm-offset-4">
                        <ul class="list-group" >
                            @for(passport <- user.passports) {
                            <li class="list-group-item">
                                @passport.passportName
                                @countryErrorMessage(passport)
                            </li>
                            }
                        </ul>
                    </div>
                </p>
                <p>Nationality(s):
                    <ul class="list-group col-sm-offset-4" >
                        @for(nationality <- user.nationality) {
                        <li class="list-group-item">
                            @nationality.nationalityName
                            @countryErrorMessage(nationality)
                        </li>
                        }
                    </ul>
                </p>
                <p>Traveller type(s):
                    <div class="col-sm-offset-4">
                        <ul class="list-group" >
                            @for(travellerType <- user.travellerTypes) {
                                <li class="list-group-item">@travellerType.travellerTypeName</li>
                            }
                        </ul>
                    </div>
                </p>
                <p>Creation date: @user.creationDate</p>
                <form>
                    <button class="btn btn-default" formaction="@routes.ProfileController.updateProfile()">Update profile</button>
                    <button class="btn btn-default" formaction="@routes.TravellerTypeController.updateTravellerType()">Update traveller type</button>
                    <button class="btn btn-default" formaction="@routes.ProfileController.updateNatPass()">Update passports/nationalities</button>
                    @if(user.userIsAdmin) {
                    <button class="btn btn-default" formaction="@routes.AdminController.indexAdmin()">Admin</button>
                    }
                </form>
            </div>
            <div class="col-md-4">
                <h2>Trips</h2>
                <form>
                    <div class="list-group">
                    @for(trip <- user.getTripsSorted) {
                        <a href="@routes.TripController.displaytrip(trip.tripid)" class="list-group-item list-group-item-action">
                            @if(trip.getTripStart() != null){
                                @trip.tripName | Arrival date: @trip.getTripStart()
                            } else{
                                @trip.tripName | No arrival dates
                            }
                        </a>
                    }
                    </div>
                    <button class="btn btn-default" formaction="@routes.DestinationController.indexDestination()">Destinations</button>
                    <button class="btn btn-default" formaction="@routes.TripController.createtrip()">Create trip</button>

                </form>
            </div>
            <div class="col-md-4">
                <h2>Insights</h2>
                <form>
                    <button class="btn btn-default" formaction="@routes.TravelPartnerController.renderFilterPage()">Search profile</button>
                </form>
            </div>
        </div>


        <br>



            <!-- Trigger the modal with a button -->
        <div>
            <span>
                <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#addPhotoModal">Add Photo</button>
            </span>
            <span class="picture-privacy-legend-span">
                <span class="legend-content">
                    <span class="public-icon">&#128065</span><span class="public-icon picture-privacy-text"> : public </span>
                </span>
                <span>
                    <span class="private-icon">&#128065</span> <span class="public-icon picture-privacy-text"> : private </span>
                </span>
            </span>

        </div>


            <!-- Modal -->
        <div id="addPhotoModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                    <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Upload a new photo </h4>
                    </div>

                    <div class="modal-body">
                    @helper.form(action = routes.HomeController.upload, 'id -> "myForm", 'enctype -> "multipart/form-data") {
                        @helper.CSRF.formField
                        <input type="file" name="picture" required>

                        <br>

                        <p>
                            <input type="submit" value="Upload">
                            @helper.CSRF.formField
                            <input type="checkbox" name="private" value="private"> Make photo private
                        </p>

                    }


                    </div>
                </div>
            </div>


        </div>

        <!-- Modal to upload a new profile picture -->
        <div id="addProfilePhoto" class="modal fade" role="dialog">
            <div class="modal-dialog">

                    <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Upload a new profile picture </h4>
                    </div>

                    <div class="modal-body">
                        <!--<input type="file" accept="image/*" name="picture" required onchange="readURL(this);"/> -->
                        <div class="profile-pic-wraper ">
                            <img class="img"  width = "450" height="375" id="change-profile-pic" src="@{routes.HomeController.serveProfilePicture(user.getUserid())}" alt="You have not uploaded a profile picture!"/>
                        </div>
                        <div class="preview-wrapper">
                            <div class="preview">

                            </div><br>
                        </div>
                        <br>
                        <input id="selectProfileInput" type="file" accept="image/*" name="picture" required onchange="loadFile(event);"/>
                        <p>
                            <button id="save-profile">Upload</button>
                        </p>
                    </div>
                </div>
            </div>


        </div>




        <br>


        <div>
            <div id="modal-picture" class="modal">
                <img class="modal-content" id="img01">
                @*<button class="btn btn-primary" id="linkButton" href="#" data-toggle="modal" data-photo-id="">Link to destination</button>*@
            </div>


            <div class="container">
                <div class="row">
                @for(i <- 0 to 2) {
                    <div class="col-sm-2">

                    @if(i < user.getUserPhotos.size() ){
                        <a id="addPhotoLink" href="#" data-toggle="modal" data-target="#destination-carousel">
                            <div class="container" id="imagesContainer" >
                                <div class="overlay">
                                    <i class="icon" title="User Profile">
                                    @if(user.getUserPhotos.get(i).isPublic()) {
                                        <i class="fa fa-eye-green"></i>
                                    } else {
                                        <i class="fa fa-eye-red"></i>
                                    }
                                    </i>
                                </div>
                                <img class="img-thumbnail" id=@{user.getUserPhotos.get(i).getUrl} width="60" src="@{routes.HomeController.index(user.getUserPhotos.get(i).getUrlWithPath)}" alt="User Image">

                            </div>
                        </a>


                    }

                    </div>
                }
                </div>

                <div class="row">
                @for(i <- 3 to 5) {
                    <div class="col-sm-2">

                    @if(i < user.getUserPhotos.size() ){
                        <a id="addPhotoLink" href="#" data-toggle="modal" data-target="#destination-carousel">
                            <div class="container" id="imagesContainer" >
                                <div class="overlay">
                                    <i class="icon" title="User Profile">
                                    @if(user.getUserPhotos.get(i).isPublic()) {
                                        <i class="fa fa-eye-green"></i>
                                    } else {
                                        <i class="fa fa-eye-red"></i>
                                    }
                                    </i>
                                </div>
                                <img class="img-thumbnail" id=@{user.getUserPhotos.get(i).getUrl} width="60" src="@{routes.HomeController.index(user.getUserPhotos.get(i).getUrlWithPath)}" alt="User Image">

                            </div>
                        </a>


                    }
                    </div>
                }
                </div>

                <div class="row">
                @for(i <- 6 to 8) {
                    <div class="col-sm-2">

                    @if(i < user.getUserPhotos.size() ){
                        <a id="addPhotoLink" href="#" data-toggle="modal" data-target="#destination-carousel">
                            <div class="container" id="imagesContainer" >
                                <div class="overlay">
                                    <i class="icon" title="User Profile">
                                    @if(user.getUserPhotos.get(i).isPublic()) {
                                        <i class="fa fa-eye-green"></i>
                                    } else {
                                        <i class="fa fa-eye-red"></i>
                                    }
                                    </i>
                                </div>
                                <img class="img-thumbnail" id=@{user.getUserPhotos.get(i).getUrl} width="60" src="@{routes.HomeController.index(user.getUserPhotos.get(i).getUrlWithPath)}" alt="User Image">

                            </div>
                        </a>


                    }

                    </div>
                }
                </div>
            </div>

        </div>
                <div id="destination-carousel" class="modal fade">
                    <div class="container">
                        <div class="carousel slide" id="myslider" data-ride="carousel" data-interval="false">
                            <ol class="carousel-indicators">
                                <li data-target="#myslider" data-slide-to="0" class="active"></li>
                                @for(i <- 1 to user.getUserPhotos().length -1) {
                                    <li data-target="#myslider" data-slide-to="@i"></li>
                                }
                            </ol>
                            <div class="carousel-inner">
                                @for(photo <- user.getUserPhotos()) {
                                    <!-- Sets the first image to be the first image displayed. To be changed to the image clicked-->
                                    @if(photo == user.getUserPhotos().get(0)){
                                        <div class="item active">
                                        } else{
                                        <div class="item">
                                        }
                                    @*<a href="#" data-toggle="modal" data-target=#@photo.getPhotoId()>*@
                                        @*<img id="carouselImage" src="@{routes.HomeController.index(photo.getUrlWithPath)}" width="1280">*@
                                    <img class="center" id="carouselImage" src="@{routes.HomeController.index(photo.getUrlWithPath)}">
                                    @*</a>*@
@*                                    <div class="carousel-caption">
                                        <h2>insert caption here</h2>
                                    </div>*@
                                    <a class="btn btn-primary" id="linkButton" href="#" data-toggle="modal" data-target="#@photo.getPhotoId()">Link to destination</a>
                                    <a class="btn btn-primary" id="setProfilePicture"
                                       onclick="setProfilePictureRequest(
                                                @photo.getPhotoId())">Set as Profile Picture</a>
                                    @if(photo.isPublic()) {
                                            <a class="btn btn-primary" id="makePrivate" href="@routes.HomeController.makePicturePublic(photo.getPhotoId, 0)" >Make Private</a>
                                        } else {
                                            <a class="btn btn-primary" id="makePublic" href="@routes.HomeController.makePicturePublic(photo.getPhotoId, 1)" >Make Public</a>
                                        }
                                </div>
                                }
                            </div>
                                <a class ="left carousel-control" href="#myslider" data-slide="prev">
                                    <span class="glyphicon glyphicon-chevron-left"></span>
                                </a>
                                <a class ="right carousel-control" href="#myslider" data-slide="next">
                                    <span class="glyphicon glyphicon-chevron-right"></span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    @for(photo <- user.getUserPhotos()) {
        <div id="@photo.getPhotoId()" class="modal fade">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1>Link photo to destination</h1>
                        @*<h2 class="modal-title">@visit.visitName</h2>*@
                    </div>
                    <div class="modal-body">
                        <h2>Private destinations</h2>
                        <input type="text" class="searchDestinations" onkeyup="searchDestination()" placeholder="Search for destinations">
                        <table class="table privateDestinations">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Country</th>
                                    <th scope="col">District</th>
                                    <th scope="col">Latitude</th>
                                    <th scope="col">Longitude</th>
                                </tr>
                            </thead>
                            <tbody>
                            @for(destination <- user.getDestinations()) {
                                @if(destination.getIsPublic() == false){
                                    <tr>
                                        <th scope ="row">@destination.getDestName()</th>
                                        <td>@destination.getDestType()</td>
                                        <td>@destination.getCountry()</td>
                                        <td>@destination.getDistrict()</td>
                                        <td>@destination.getLatitude()</td>
                                        <td>@destination.getLongitude()</td>
                                        <td><button class="btn btn-primary" onclick="sendLinkDestinationRequest(
                                                '@routes.DestinationController.linkPhotoToDestination(destination.getDestId())',
                                                @photo.getPhotoId())">Link to destination</button></td>
                                    </tr>


                                    <br>
                                    }
                            }
                            </tbody>
                        </table>


                        <h2>Public destinations</h2>
                        <input type="text" class="searchPublicDestinations" onkeyup="searchPublicDestination()" placeholder="Search for destinations">
                        <table class="table publicDestinations">
                            <thead class="thead-dark">
                                <tr>
                                    <th scope="col">Name</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Country</th>
                                    <th scope="col">District</th>
                                    <th scope="col">Latitude</th>
                                    <th scope="col">Longitude</th>
                                </tr>
                            </thead>
                            <tbody>
                            @for(destination <- Destination.find.all()) {
                                @if(destination.getIsPublic() == true){
                                    <tr>
                                        <th scope ="row">@destination.getDestName()</th>
                                        <td>@destination.getDestType()</td>
                                        <td>@destination.getCountry()</td>
                                        <td>@destination.getDistrict()</td>
                                        <td>@destination.getLatitude()</td>
                                        <td>@destination.getLongitude()</td>
                                            <!-- TO BE CHANGED -->
                                        <td><button class="btn btn-primary" onclick="sendLinkDestinationRequest(
                                                '@routes.DestinationController.linkPhotoToDestination(destination.getDestId())',
                                                @photo.getPhotoId())">Link to destination</button></td>
                                    </tr>
                                    <br>
                                    }
                            }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }
    <script>
    var modal = document.getElementById('destination-carousel');
            // Get the modal THIS HAS BEEN EDITED AT 1:41 PM TODAY
            // var modal = document.getElementById('modal-picture');
            @*var modal = document.getElementById('destination-carousel');*@
            @*// When the user clicks, they quit the modal view*@
            @*modal.onclick = function () {*@
                @*this.style.display = "none";*@
            @*};*@

            @*// Get the image and insert it inside the modal*@
            @*var images = document.getElementsByClassName("img-thumbnail");*@
            @*var modalImg = document.getElementById("img01");*@
            @*var modalLink = document.getElementById("linkButton");*@
            @*// loops through each thumbnail and adds the event listener*@
            @*for (i = 0; i < @user.getUserPhotos.length; i++) {*@
                @*images[i].onclick = function() {*@
                    @*modal.style.display = "block";*@
                    @*console.log("this happened");*@
                    @*modalImg.src = this.src;*@
                @*};*@
            @*}*@
    </script>
    <script src="@routes.Assets.at("js/cropper.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("js/home.js")" type="text/javascript"></script>
}
